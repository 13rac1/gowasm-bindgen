# gowasm-bindgen for TypeScript Developers

You know TypeScript. You're curious about Go. Here's how to run Go code in your browser with full type safety.

## Why Go in the Browser?

- **Performance**: Go compiles to WebAssembly, running at near-native speed
- **Shared logic**: Use the same code on your backend and frontend
- **Type safety**: With gowasm-bindgen, your Go functions get proper TypeScript types

## What You Need to Know

Your Go teammate writes the WASM module and tests. You use the generated `.d.ts` file. That's it.

**The 3 files you care about:**

| File | What it is |
|------|------------|
| `example.wasm` | The compiled Go code (runs in the browser) |
| `wasm_exec.js` | Go's WASM runtime (loads the .wasm file) |
| `types.d.ts` | Generated TypeScript declarations (gives you types) |

## Using the Generated Types

### 1. Reference the types in your TypeScript

```typescript
/// <reference path="./types.d.ts" />
```

### 2. Load the WASM module

```typescript
declare const Go: any;  // From wasm_exec.js
const go = new Go();

const result = await WebAssembly.instantiateStreaming(
    fetch("./example.wasm"),
    go.importObject
);
go.run(result.instance);
```

### 3. Call Go functions with full type checking

```typescript
// TypeScript knows: greet(name: string): string
const greeting = window.greet("World");
console.log(greeting);  // "Hello, World!"

// TypeScript knows: calculate(a: number, b: number, op: string): number
const sum = window.calculate(5, 3, "add");
console.log(sum);  // 8

// TypeScript knows the return type is { displayName: string, status: string }
const user = window.formatUser("Alice", 30, true);
console.log(user.displayName);  // "Alice (30)"
console.log(user.status);       // "active"
```

### 4. TypeScript catches your mistakes

```typescript
// Error: Argument of type 'number' is not assignable to parameter of type 'string'
window.greet(42);

// Error: Expected 3 arguments, but got 2
window.calculate(5, 3);

// Error: Property 'wrongField' does not exist
const user = window.formatUser("Bob", 25, false);
console.log(user.wrongField);
```

## Complete Example

See the [example/web/app.ts](../example/web/app.ts) for a working TypeScript application that uses generated types.

```typescript
/// <reference path="../types.d.ts" />

declare const Go: any;
const go = new Go();

WebAssembly.instantiateStreaming(fetch("../example.wasm"), go.importObject)
    .then((result) => {
        go.run(result.instance);

        // Now you can call Go functions with type safety
        const greeting: string = window.greet("TypeScript");
        console.log(greeting);
    });
```

## Troubleshooting

### "Property 'greet' does not exist on type 'Window'"

You need to include the generated types. Add this to the top of your TypeScript file:

```typescript
/// <reference path="./types.d.ts" />
```

Or add the `.d.ts` file to your `tsconfig.json`:

```json
{
  "include": ["src/**/*", "types.d.ts"]
}
```

### "Cannot find name 'Go'"

The `Go` constructor comes from `wasm_exec.js`. Make sure you've loaded it before your code runs:

```html
<script src="wasm_exec.js"></script>
<script src="your-app.js"></script>
```

### Return type is `any` instead of a specific type

This means the Go tests don't specify how the return value is used. Ask your Go teammate to add type assertions in their tests:

```go
// Go test code - the .String() tells gowasm-bindgen the return type
result := greet(js.Null(), []js.Value{js.ValueOf("World")})
jsResult := result.(js.Value)
got := jsResult.String()  // <- This makes the return type 'string'
```

### WASM won't load / "failed to asynchronously prepare wasm"

- Make sure your server serves `.wasm` files with the correct MIME type: `application/wasm`
- Check the browser console for more specific errors
- Try using `WebAssembly.instantiate` instead of `instantiateStreaming` for debugging

## Project Structure

A typical project using gowasm-bindgen looks like this:

```
your-project/
├── wasm/
│   ├── main.go           # Go code (your teammate writes this)
│   └── main_test.go      # Tests (gowasm-bindgen reads this)
├── web/
│   ├── index.html
│   └── app.ts            # Your TypeScript code
├── types.d.ts            # Generated by gowasm-bindgen
├── example.wasm          # Compiled Go code
└── wasm_exec.js          # Go's WASM runtime
```

## Next Steps

- Check out the [example/](../example/) directory for a complete working demo
- Run `make serve` in the example directory to try it in your browser
- Read [for-go-devs.md](./for-go-devs.md) if you want to understand how the Go side works
